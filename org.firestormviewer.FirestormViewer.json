{
    "app-id":"org.firestormviewer.FirestormViewer",
    "runtime":"org.freedesktop.Platform",
    "runtime-version":"22.08",
    "sdk":"org.freedesktop.Sdk",
    "command":"firestorm-viewer",
    "separate-locales":false,
    "finish-args":[
        "--share=ipc",
        "--socket=x11",
        "--socket=pulseaudio",
        "--share=network",
        "--allow=multiarch",
        "--device=dri",
        "--filesystem=~/.firestorm_x64:create",
        "--filesystem=xdg-desktop",
        "--filesystem=xdg-documents",
        "--filesystem=xdg-download",
        "--filesystem=xdg-music",
        "--filesystem=xdg-pictures",
        "--filesystem=xdg-run/app/com.discordapp.Discord:create",
        "--talk-name=org.freedesktop.Notifications",
        "--talk-name=org.freedesktop.secrets",
        "--own-name=com.secondlife.ViewerAppAPIService",
        "--env=LD_LIBRARY_PATH=/app/extra/lib/:/app/lib32/:/app/lib"
    ],
    "cleanup":[
        "/share/man",
        "/share/doc",
        "/share/gtk-doc",
        "/lib/pkgconfig"
    ],
    "build-options":{
        "strip":true
    },
    "add-extensions":{
        "org.freedesktop.Platform.Compat.i386":{
            "directory":"lib/i386-linux-gnu",
            "version":"22.08"
        }
    },
    "sdk-extensions":[
        "org.freedesktop.Sdk.Compat.i386",
        "org.freedesktop.Sdk.Extension.toolchain-i386"
    ],
    "modules":[
        "shared-modules/glu/glu-9.json",
        "shared-modules/gtk2/gtk2.json",
        "shared-modules/dbus-glib/dbus-glib.json",
        {
            "name":"libnotify",
            "buildsystem":"meson",
            "config-opts":[
                "-Ddocbook_docs=disabled",
                "-Dintrospection=disabled",
                "-Dtests=false",
                "-Dgtk_doc=false",
                "-Dman=false"
            ],
            "cleanup":[
                "/bin"
            ],
            "sources":[
                {
                    "type":"archive",
                    "url":"https://download.gnome.org/sources/libnotify/0.8/libnotify-0.8.3.tar.xz",
                    "sha256":"ee8f3ef946156ad3406fdf45feedbdcd932dbd211ab4f16f75eba4f36fb2f6c0"
                }
            ]
        },
        {
            "name":"libidn",
            "sources":[
                {
                    "type":"archive",
                    "url":"https://ftp.gnu.org/gnu/libidn/libidn-1.34.tar.gz",
                    "sha256":"3719e2975f2fb28605df3479c380af2cf4ab4e919e1506527e4c7670afff6e3c"
                }
            ],
            "build-options":{
                "arch":{
                    "x86_64":{
                        "prepend-pkg-config-path":"/app/lib32/pkgconfig:/usr/lib/i386-linux-gnu/pkgconfig",
                        "ldflags":"-L/app/lib32",
                        "append-path":"/usr/lib/sdk/toolchain-i386/bin",
                        "env":{
                            "CC":"i686-unknown-linux-gnu-gcc",
                            "CXX":"i686-unknown-linux-gnu-g++"
                        },
                        "libdir":"/app/lib32"
                    }
                }
            }
        },
        {
            "name":"libgnome-keyring",
            "config-opts":[
                "--disable-static",
                "--disable-gtk-doc",
                "--disable-coverage",
                "--disable-introspection"
            ],
            "sources":[
                {
                    "type":"archive",
                    "url":"https://download.gnome.org/sources/libgnome-keyring/3.12/libgnome-keyring-3.12.0.tar.xz",
                    "sha256":"c4c178fbb05f72acc484d22ddb0568f7532c409b0a13e06513ff54b91e947783"
                },
                {
                    "type":"shell",
                    "commands":[
                        "autoreconf -fi"
                    ]
                }
            ]
        },
        {
            "name":"ubuntu-libcypto",
            "buildsystem":"simple",
            "sources":[
                {
                    "type":"file",
                    "url":"http://mirrors.edge.kernel.org/ubuntu/pool/main/libx/libxcrypt/libcrypt1_4.4.27-1_amd64.deb",
                    "sha256":"3fa566e9f861a08736cbc5a97562d9d6e4f0c00450fbeafcb6d7583423b04a98"
                }
            ],
            "build-commands":[
                  "ar x libcrypt1_4.4.27-1_amd64.deb",
                  "tar -xvf data.tar.zst",
                  "cp lib/x86_64-linux-gnu/* /app/lib/"
            ]
        },
        {
            "name":"firestorm",
            "buildsystem":"simple",
            "sources":[
                {
                    "type":"extra-data",
                    "filename":"viewer.tar.xz",
                    "url":"https://downloads.firestormviewer.org/release/linux/Phoenix-FirestormOS-Releasex64-7-1-9-74745.tar.xz",
                    "sha256":"2087e11268976406b809f8e16d2daeef11c7f3f8642c7d6c6a9e4506de986720",
                    "size": 190763824
                },
                {
                    "type":"script",
                    "dest-filename":"apply_extra",
                    "commands":[
                        "tar -xf viewer.tar.xz --strip 1 --no-same-owner",
                        "rm viewer.tar.xz",
                        "cp /app/etc/launch_url.sh etc/"
                    ]
                },
                {
                    "type":"file",
                    "path":"assets/firestorm-viewer"
                },
                {
                    "type":"file",
                    "path":"assets/launch_url.sh"
                },
                {
                    "type":"file",
                    "path":"assets/org.firestormviewer.FirestormViewer.desktop"
                },
                {
                    "type":"file",
                    "path":"assets/org.firestormviewer.FirestormViewer.metainfo.xml"
                },
                {
                    "type":"file",
                    "url":"https://vcs.firestormviewer.org/phoenix-firestorm-lgpl/raw/5e2050564bd3730f0ce7843860afdb25da3d2346/indra/newview/res/firestorm_icon.png",
                    "sha256":"f51c4c1609d6fe1a75914f3644888816525524e641c2f2821436993921800390",
                    "dest-filename":"org.firestormviewer.FirestormViewer.png"
                }
            ],
            "build-commands":[
                "install apply_extra /app/bin/",
                "install launch_url.sh /app/etc/",
                "install -Dm755 firestorm-viewer $FLATPAK_DEST/bin/",
                "install -Dm644 $FLATPAK_ID.desktop $FLATPAK_DEST/share/applications/$FLATPAK_ID.desktop",
                "install -Dm644 $FLATPAK_ID.png $FLATPAK_DEST/share/icons/hicolor/512x512/apps/$FLATPAK_ID.png",
                "install -Dm644 $FLATPAK_ID.metainfo.xml $FLATPAK_DEST/share/metainfo/$FLATPAK_ID.metainfo.xml",
                "mkdir $FLATPAK_DEST/lib/i386-linux-gnu"
            ]
        }
    ]
}

